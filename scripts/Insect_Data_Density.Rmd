---
title: "Data Density of Potential Insect Species"
author: "Michael W Belitz"
date: "2/1/2020"
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r mappingScript, echo=FALSE, warning=FALSE, message=FALSE}
library(rgbif)
library(dplyr)
library(lubridate)
library(ggplot2)
library(rnaturalearth)
library(sf)

# function to map gbif occurrence data

map_occ_data <- function(binomial){
  dat <- occ_search(scientificName = binomial, hasCoordinate = TRUE, country = "US", limit = 200000)
  
  sp_df <- dat$data %>% 
    mutate(doy = lubridate::day(eventDate)) %>% 
    filter(!is.na(year)) %>% 
    filter(!is.na(doy))
  
  
  
  us <- rnaturalearth::ne_countries(country = "United States of America", 
                                 returnclass = "sf")
  
  ggplot() + 
    geom_sf(us, mapping = aes()) + 
    geom_point(sp_df, mapping = aes(x = decimalLongitude, y = decimalLatitude, color = basisOfRecord)) + 
    coord_sf( xlim = c(-125, -65), ylim = c(20, 60))+
    ggtitle(label = binomial) +
    facet_wrap(~year)
}

## Function to make summary table

summarize_occ_data <- function(binomial){
  dat <- occ_search(scientificName = binomial, hasCoordinate = TRUE, country = "US", limit = 200000)
  
  sp_df <- dat$data %>% 
    mutate(doy = lubridate::day(eventDate)) %>% 
    filter(!is.na(year)) %>% 
    filter(!is.na(doy))
  
  sum_table <- sp_df %>% 
    group_by(year, basisOfRecord) %>% 
    summarise(count = n())
  
  sum_table <- sum_table %>% 
    filter(count >= 10)
  
  return(sum_table)
}
```


## Data density of potential insects 

For this initial exploration, I wrote a function that would map the observations and show the basisOfRecord for a species of choice through time. I also summarize the number of obsevations per basisOfRecord for each available year. The summary table only shows years with >= 10 observations per basisOfRecord.  

## Dung Beetles
Top species on iNat: Japanese Beetle - Popilia japonica 

```{r scarabedia, echo=FALSE, cache=TRUE, fig.width=8, fig.height=11}
summarize_occ_data("Popillia japonica")
map_occ_data("Popillia japonica")
```

## Lubber Grasshoppers - Romaleidae
Romalea microptera (Eastern Lubber Grasshopper)

```{r romaleidae, echo=FALSE, cache=TRUE,fig.width=8, fig.height=11}
summarize_occ_data("Romalea microptera")
map_occ_data("Romalea microptera")
```

## Silk moths - Saturniidae
Antheraea polyphemus (Polyphemus Moth)

```{r saturniidae, echo=FALSE, cache=TRUE, fig.width=8, fig.height=11}
summarize_occ_data("Antheraea polyphemus")
map_occ_data("Antheraea polyphemus")
```

## Lady Beetles - Coccinellidae
Harmonia axyridis (Asian Lady Beetle)

```{r coccinellidae, echo=FALSE, cache=TRUE, fig.width=8, fig.height=11}
summarize_occ_data("Harmonia axyridis")
map_occ_data("Harmonia axyridis")
```

## Carrion Beetles - Silphidae
Necrophila americana American Carrion Beetle

```{r silphidae, echo=FALSE, cache=TRUE, fig.width=8, fig.height=11}
summarize_occ_data("Necrophila americana")
map_occ_data("Necrophila americana")
```

## Mayflies - Ephemeroptera
Hexagenia limbata (Giant Mayfly)

```{r ephemeroptera, echo=FALSE, cache=TRUE, fig.width=8, fig.height=11}
summarize_occ_data("Hexagenia limbata")
map_occ_data("Hexagenia limbata")
```

## Cicadas (Cicadidae)
Neotibicen tibicen (Swamp Cicada)

```{r cicadidae, echo=FALSE, cache=TRUE, fig.width=8, fig.height=11}
summarize_occ_data("Neotibicen tibicen")
map_occ_data("Neotibicen tibicen")
```

## Stink Bugs (Pentatomidae)
First I'll do the brown marmorated, but it is a recent invasive. 
Halyomorpha halys (Brown Marmorated Stink Bug)
```{r pentatomidae, echo=FALSE, cache=TRUE, fig.width=8, fig.height=11}
summarize_occ_data("Halyomorpha halys")
map_occ_data("Halyomorpha halys")
```

Here's the second most observed on iNat.
Chinavia hilaris (Green Stink Bug) Chinavia halaris
Well tried to do this for Chinavia hilaris, but iNat and gbif disagree on taxonomy. So just using Chinavia genus.
```{r pentatomidae2, echo=FALSE, cache=TRUE, fig.width=8, fig.height=11}
summarize_occ_data("Chinavia")
map_occ_data("Chinavia")
```

## Dragonflies (Odonata)
Pachydiplax longipennis (Blue Dasher)
```{r odonata, echo=FALSE, cache=TRUE, fig.width=8, fig.height=11}
summarize_occ_data("Pachydiplax longipennis")
map_occ_data("Pachydiplax longipennis")
```

## Typical Leaf Hoppers (Cicadellidae)
Graphocephala coccinea (Red-banded Leafhopper)

```{r cicadellidae, echo=FALSE, cache=TRUE, fig.width=8, fig.height=11}
summarize_occ_data("Graphocephala coccinea")
map_occ_data("Graphocephala coccinea")
```

## Katydids (Orthoptera)
Scudderia furcata (Fork-tailed Bush Katydid)

```{r orthoptera2, echo=FALSE, cache=TRUE, fig.width=8, fig.height=11}
summarize_occ_data("Scudderia furcata")
map_occ_data("Scudderia furcata")
```

## Dobsonflies and fishflies (Megaloptera)
Corydalus cornutus (Eastern Dobsonfly)

```{r megaloptera, echo=FALSE, cache=TRUE, fig.width=8, fig.height=11}
summarize_occ_data("Corydalus cornutus")
map_occ_data("Corydalus cornutus")
```

## Velvet Ants (Mutillidae)
Dasymutilla occidentalis (Common Eastern Velvet Ant)

```{r mutillidae, echo=FALSE, cache=TRUE, fig.width=8, fig.height=11}
summarize_occ_data("Dasymutilla occidentalis")
map_occ_data("Dasymutilla occidentalis")
```

## Prosapia bicincta (Two-lined Spittlebug)
```{r prosapia, echo=FALSE, cache=TRUE, fig.width=8, fig.height=11}
summarize_occ_data("Prosapia bicincta")
map_occ_data("Prosapia bicincta")
```


## Leaf-footed/squash bugs (Coreidae)
Acanthocephala terminalis (Spine-headed Bug)

```{r coreidae, echo=FALSE, cache=TRUE, fig.width=8, fig.height=11}
summarize_occ_data("Acanthocephala terminalis")
map_occ_data("Acanthocephala terminalis")
```
